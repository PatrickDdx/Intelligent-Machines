{"title":"Predicting Medical Costs - A Regression Problem","markdown":{"yaml":{"title":"Predicting Medical Costs - A Regression Problem","author":"Patrick Linke","date":"2025-10-26","categories":["Regression","Medicine"],"execute":false},"headingText":"Introduction","containsRefs":false,"markdown":"\n\n![](images/medical_costs_cover.png)\n\n\n## 1. Key Results\n\n- *Charges generally rise with age.*\n- *Smokers consistently have higher and more variable charges than non-smokers.*\n\n![Fig. 0 Showing the most important features identified by a Decision Tree Regressor.](images/Decision_Tree_plot_small.png)\n\n## 2. Why It Matters\n\nPredicting medical costs isn’t just a math problem — it’s about understanding the real price of our health choices. For insurers, these predictions guide fairer pricing and risk assessment. For individuals, they reveal how habits like smoking or maintaining a healthy BMI can shape future expenses. In a world where healthcare costs can make or break financial stability, this kind of model helps turn data into smarter, more informed decisions.\n\n## 3. The Data\n\nThe dataset comes from the [Medical Cost Personal Dataset](https://www.kaggle.com/datasets/mirichoi0218/insurance) on Kaggle, containing **1,338 observations**, each representing a single U.S. health insurance policyholder. Key features include **age**, **sex**, **BMI**, **number of children**, **smoker status**, and **region**. The **target variable**, *charges*, captures each person’s annual medical cost, ranging from about $1,000 to over $60,000. Despite its small size, the dataset offers rich insights into how lifestyle and demographics drive healthcare expenses.\n\n![Fig. 1 Shows the Distribution of Numeric Features in the Medical Costs Dataset](images/numeric_dist_histplot.png)\n\n![Fig. 2 Shows the Distribution of Categorical Features in the Medical Costs Dataset](images/cat_dist_histplot.png)\n\n# Methods & Results\n\n## 4. What I Did\n\nExplored the medical cost dataset with visuals — distributions, correlations, and feature effects — to link age, BMI, and smoking to charges. Cleaned numeric features with StandardScaler and categorical variables with OneHotEncoder.\nTrained LinearRegression, SVR, DecisionTreeRegressor, and RandomForestRegressor, tuning hyperparameters with RandomizedSearchCV. Evaluated MAE, MSE, RMSE, and R² on the test set and compared models visually.\n\n## 5. What I Found\n\n\n\n\nInsurance charges tend to increase with age. Smokers have significantly higher and more variable charges compared to non-smokers, whose costs show a smoother, more consistent trend.  \nAmong smokers, insurance charges generally increase with higher BMI, while BMI has little impact on costs for non-smokers. Within non-smokers, age drives costs.\n\nFeature importance analysis (from the tree-based models) highlighted smoking, age, and BMI as the top predictors — confirming both domain expectations and model consistency.\n\nThe Random Forest Regressor achieved the best results, with the lowest RMSE (≈ 4354) and highest R² (≈ 0.88), indicating strong predictive accuracy and generalization on unseen data, showing that it is possible to predict medical costs based on key personal and lifestyle factors. This demonstrates that data-driven models can effectively capture the underlying relationships between health behaviors and medical expenses, enabling more accurate cost forecasting and better-informed healthcare and policy decisions.\n\n![Fig. 3 Charges increase with age, and smokers have significantly higher and more variable charges than non-smokers.](images/age_vs_charges.png)\n\n![Fig. 4 Smokers consistently have higher charges than non-smokers. Among smokers, charges increase strongly with BMI (r ≈ 0.81), while among non-smokers, BMI has almost no relationship with charges (r ≈ 0.08). This indicates a strong interaction effect — smoking amplifies the impact of BMI on charges.](images/bmi_vs_charges.png)\n\n\n![Fig. 5  Decision tree regression model predicting medical insurance charges. The model splits data points into groups based on key factors. The most important splitting criterion is smoking status. Among non-smokers, age is the most influential variable, while for smokers, BMI plays the dominant role. The “value” shown in each node represents the model’s predicted target value (here, the estimated insurance cost in dollars).](images/Decision_Tree_plot.png)\n\n![Fig. 6 Comparison of Root Mean Squared Error (RMSE) values for different regression models on the test set. The RMSE measures the average magnitude of prediction errors, with lower values indicating better model performance. The Random Forest Regressor achieved the lowest RMSE, followed by the Decision Tree Regressor, while the SVR and Linear Regression models showed higher error levels, suggesting less accurate predictions.)](images/RMSE_score.png)\n\n![Fig. 7 Comparison of R² scores for different regression models on the test set. The R² score represents the proportion of variance in medical insurance charges explained by each model. Higher values indicate better predictive performance. The Random Forest Regressor achieved the highest R², followed closely by the Decision Tree Regressor, while Linear Regression and SVR showed comparatively lower explanatory power.](images/R2_score.png)\n\n# Conclusion\n\n## 6. What I Learned\n\nModel performance improved with complexity:  \nTree-based models, especially Random Forest, captured the nonlinear impact of health and lifestyle factors most effectively. The findings align with real-world intuition — smokers and older individuals face substantially higher insurance costs.\n\n## 7. What’s Next\n\nThis project shows that predicting medical costs is possible — but there’s room to grow. Future work could explore more advanced models like Gradient Boosting or XGBoost to see if they capture even subtler patterns in the data. Another direction is adding richer features to improve model depth and realism. Finally, scaling this work to larger, more diverse datasets would help assess how well these findings hold up across different populations. The next steps are open — it’s up to you to take this foundation and push it further.\n\n# Credits\n\nYou can find the Notebook here: \n\nInspired by Chapter 2 from [Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow, 3rd Edition by Aurélien Géron](https://www.oreilly.com/library/view/hands-on-machine-learning/9781098125967/)\n\n[Download the Notebook](blog_Regression_project.ipynb){download}\n\n[donladtest](data/insurance.csv){download}\n\n---\n\n---\n\n# Behind The Scenes (My Code)\n\nLoading the data and checking out the first 5 rows\n\n## EDA\n\nChecking the structure of the DataFrame\n\nChecking for missing values\n\nCreating a new column with catrgorical BMI features\n\nBMI Categories\n\n| BMI Category | BMI Range |\n| :--- | :--- |\n| Underweight | Below 18.5 |\n| Healthy | 18.5 – 24.9 |\n| Overweight | 25.0 – 29.9 |\n| Obesity | 30.0 or above |\n\nPlotting the distribution of the numeric columns\n\nPlotting the distribution of categorical columns\n\nTaking a look at the target variable\n\nCheck the correlation between Smoking and BMI on the charges\n\n## Preprocessing\n\n### Train Test Split\n\n## Training a Model\n\n### LinearRegression\n\n### SVR\n\n### DecisionTree\n\nUsing a simple DecisionTree as a baseline\n\nUsing RandomizedSearch to find the best parameters for the Decisiontree\n\nSmaller iamges for the Blog:\n\n### RandomForestRegressor\n\n### Comparing Models\n","srcMarkdownNoYaml":"\n\n![](images/medical_costs_cover.png)\n\n# Introduction\n\n## 1. Key Results\n\n- *Charges generally rise with age.*\n- *Smokers consistently have higher and more variable charges than non-smokers.*\n\n![Fig. 0 Showing the most important features identified by a Decision Tree Regressor.](images/Decision_Tree_plot_small.png)\n\n## 2. Why It Matters\n\nPredicting medical costs isn’t just a math problem — it’s about understanding the real price of our health choices. For insurers, these predictions guide fairer pricing and risk assessment. For individuals, they reveal how habits like smoking or maintaining a healthy BMI can shape future expenses. In a world where healthcare costs can make or break financial stability, this kind of model helps turn data into smarter, more informed decisions.\n\n## 3. The Data\n\nThe dataset comes from the [Medical Cost Personal Dataset](https://www.kaggle.com/datasets/mirichoi0218/insurance) on Kaggle, containing **1,338 observations**, each representing a single U.S. health insurance policyholder. Key features include **age**, **sex**, **BMI**, **number of children**, **smoker status**, and **region**. The **target variable**, *charges*, captures each person’s annual medical cost, ranging from about $1,000 to over $60,000. Despite its small size, the dataset offers rich insights into how lifestyle and demographics drive healthcare expenses.\n\n![Fig. 1 Shows the Distribution of Numeric Features in the Medical Costs Dataset](images/numeric_dist_histplot.png)\n\n![Fig. 2 Shows the Distribution of Categorical Features in the Medical Costs Dataset](images/cat_dist_histplot.png)\n\n# Methods & Results\n\n## 4. What I Did\n\nExplored the medical cost dataset with visuals — distributions, correlations, and feature effects — to link age, BMI, and smoking to charges. Cleaned numeric features with StandardScaler and categorical variables with OneHotEncoder.\nTrained LinearRegression, SVR, DecisionTreeRegressor, and RandomForestRegressor, tuning hyperparameters with RandomizedSearchCV. Evaluated MAE, MSE, RMSE, and R² on the test set and compared models visually.\n\n## 5. What I Found\n\n\n\n\nInsurance charges tend to increase with age. Smokers have significantly higher and more variable charges compared to non-smokers, whose costs show a smoother, more consistent trend.  \nAmong smokers, insurance charges generally increase with higher BMI, while BMI has little impact on costs for non-smokers. Within non-smokers, age drives costs.\n\nFeature importance analysis (from the tree-based models) highlighted smoking, age, and BMI as the top predictors — confirming both domain expectations and model consistency.\n\nThe Random Forest Regressor achieved the best results, with the lowest RMSE (≈ 4354) and highest R² (≈ 0.88), indicating strong predictive accuracy and generalization on unseen data, showing that it is possible to predict medical costs based on key personal and lifestyle factors. This demonstrates that data-driven models can effectively capture the underlying relationships between health behaviors and medical expenses, enabling more accurate cost forecasting and better-informed healthcare and policy decisions.\n\n![Fig. 3 Charges increase with age, and smokers have significantly higher and more variable charges than non-smokers.](images/age_vs_charges.png)\n\n![Fig. 4 Smokers consistently have higher charges than non-smokers. Among smokers, charges increase strongly with BMI (r ≈ 0.81), while among non-smokers, BMI has almost no relationship with charges (r ≈ 0.08). This indicates a strong interaction effect — smoking amplifies the impact of BMI on charges.](images/bmi_vs_charges.png)\n\n\n![Fig. 5  Decision tree regression model predicting medical insurance charges. The model splits data points into groups based on key factors. The most important splitting criterion is smoking status. Among non-smokers, age is the most influential variable, while for smokers, BMI plays the dominant role. The “value” shown in each node represents the model’s predicted target value (here, the estimated insurance cost in dollars).](images/Decision_Tree_plot.png)\n\n![Fig. 6 Comparison of Root Mean Squared Error (RMSE) values for different regression models on the test set. The RMSE measures the average magnitude of prediction errors, with lower values indicating better model performance. The Random Forest Regressor achieved the lowest RMSE, followed by the Decision Tree Regressor, while the SVR and Linear Regression models showed higher error levels, suggesting less accurate predictions.)](images/RMSE_score.png)\n\n![Fig. 7 Comparison of R² scores for different regression models on the test set. The R² score represents the proportion of variance in medical insurance charges explained by each model. Higher values indicate better predictive performance. The Random Forest Regressor achieved the highest R², followed closely by the Decision Tree Regressor, while Linear Regression and SVR showed comparatively lower explanatory power.](images/R2_score.png)\n\n# Conclusion\n\n## 6. What I Learned\n\nModel performance improved with complexity:  \nTree-based models, especially Random Forest, captured the nonlinear impact of health and lifestyle factors most effectively. The findings align with real-world intuition — smokers and older individuals face substantially higher insurance costs.\n\n## 7. What’s Next\n\nThis project shows that predicting medical costs is possible — but there’s room to grow. Future work could explore more advanced models like Gradient Boosting or XGBoost to see if they capture even subtler patterns in the data. Another direction is adding richer features to improve model depth and realism. Finally, scaling this work to larger, more diverse datasets would help assess how well these findings hold up across different populations. The next steps are open — it’s up to you to take this foundation and push it further.\n\n# Credits\n\nYou can find the Notebook here: \n\nInspired by Chapter 2 from [Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow, 3rd Edition by Aurélien Géron](https://www.oreilly.com/library/view/hands-on-machine-learning/9781098125967/)\n\n[Download the Notebook](blog_Regression_project.ipynb){download}\n\n[donladtest](data/insurance.csv){download}\n\n---\n\n---\n\n# Behind The Scenes (My Code)\n\nLoading the data and checking out the first 5 rows\n\n## EDA\n\nChecking the structure of the DataFrame\n\nChecking for missing values\n\nCreating a new column with catrgorical BMI features\n\nBMI Categories\n\n| BMI Category | BMI Range |\n| :--- | :--- |\n| Underweight | Below 18.5 |\n| Healthy | 18.5 – 24.9 |\n| Overweight | 25.0 – 29.9 |\n| Obesity | 30.0 or above |\n\nPlotting the distribution of the numeric columns\n\nPlotting the distribution of categorical columns\n\nTaking a look at the target variable\n\nCheck the correlation between Smoking and BMI on the charges\n\n## Preprocessing\n\n### Train Test Split\n\n## Training a Model\n\n### LinearRegression\n\n### SVR\n\n### DecisionTree\n\nUsing a simple DecisionTree as a baseline\n\nUsing RandomizedSearch to find the best parameters for the Decisiontree\n\nSmaller iamges for the Blog:\n\n### RandomForestRegressor\n\n### Comparing Models\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":false,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":false,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"jupyter"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"output-file":"blog_Regression_project.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.8.25","theme":"cosmo","code-copy":true,"title":"Predicting Medical Costs - A Regression Problem","author":"Patrick Linke","date":"2025-10-26","categories":["Regression","Medicine"]},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}